(this["webpackJsonpvizzion-client"]=this["webpackJsonpvizzion-client"]||[]).push([[0],{31:function(e,t,a){e.exports=a(61)},36:function(e,t,a){},61:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(25),l=a.n(r),i=a(4),c=(a(36),a(72)),s=a(13),d=a.n(s),u=Object(c.a)({partyContainer:{width:"20%"},party:function(e){return{display:"flex",alignItems:"center",fontWeight:"bold",letterSpacing:2,padding:"5px 5px",margin:1,borderRadius:5,color:"white",justifyItems:"center",justifyContent:"space-between",backgroundColor:e.color}},popVote:{padding:5,fontWeight:"bold"}}),m=function(e){var t=u(e);return o.a.createElement("div",{className:t.partyContainer},o.a.createElement("div",{className:t.party},o.a.createElement("div",null,e.name),o.a.createElement("div",null,e.seats)),o.a.createElement("div",{className:t.popVote},e.small?"".concat(e.votes,"%"):"Pop vote: ".concat(e.votes,"%")))},p=a(28),f=Object(c.a)({meter:{maxWidth:"95%",position:"relative",minHeight:"20px"},bar:{background:function(e){return e.color},width:"0%",borderRadius:"0px 5px 5px 0px",height:10,margin:2,animationName:"animate-bar",animationDuration:"0.5s",transition:"width 300ms ease-in-out",transitionDelay:"100ms",zIndex:20},majorityLine:{position:"absolute",height:"120%",minHeight:"20px",bottom:-2,borderLeft:"2px solid black",transition:"left 300ms ease-in-out"},majorityLabel:{position:"absolute",textAlign:"left",top:-25,marginLeft:-7,fontWeight:"bolder",transition:"right 300ms ease-in-out"}});function g(e){e.color;var t=e.votes,a=Object(p.a)(e,["color","votes"]),n=f(e);return o.a.createElement("div",Object.assign({className:"animate-bar ".concat(n.bar),style:{width:t}},a))}var b=function(e){var t=Object(n.useState)(null),a=Object(i.a)(t,2),r=a[0],l=a[1],c=Object(n.useState)(50),s=Object(i.a)(c,2),d=s[0],u=s[1],m=f(e);return Object(n.useEffect)((function(){if(e.data){var t=e.data.partyResults[0];t.seats>=e.majority?(console.log("1",e.majority,t.seats),l(t.seats),u(e.majority/t.seats*100)):(console.log("2"),l(e.majority),u(e.majority/e.majority*100))}}),[e.data,e.seatTotal,e.majority]),o.a.createElement("div",{className:m.meter},console.log("line position",d),o.a.createElement("div",{className:m.majorityLabel,style:{right:"".concat(100-d,"%")}},e.majority," seats needed for majority"),e.data&&r&&e.data.partyResults.map((function(e,t){return o.a.createElement(g,{key:t,color:e.color,votes:e.seats>0?"".concat(e.seats/r*100,"%"):"0.5%"})})),o.a.createElement("div",{className:m.majorityLine,style:{left:"".concat(d,"%")}}))},v=a(26),y=a.n(v),j=Object(c.a)({root:{display:"flex",alignItems:"center",paddingBottom:15,fontWeight:"bolder",alignSelf:"flex-start",fontSize:14,paddingLeft:5,"& svg":{color:"green",fontSize:20,paddingRight:5}}}),h=function(e){var t=j();return o.a.createElement("div",{className:e.declarationText&&t.root},o.a.createElement(y.a,null),e.declarationText)},x=Object(c.a)({main:{display:"flex",position:"relative",flexDirection:"column",padding:"10px 10px",backgroundColor:"#ededf0"},titleRow:{display:"flex",padding:"0px 5px 5px 5px",justifyContent:"space-between"},title:{fontSize:24,fontWeight:"bold"},barchart:{fontSize:14,display:"flex",padding:"20px 0",flexDirection:"column-reverse",flexWrap:"wrap"},partyMap:{fontSize:16,display:"flex",flexWrap:"wrap",alignContent:"left"},update:{padding:"15px 5px",fontSize:10}}),E=function(e){var t=x(e),a=Object(n.useState)(null),r=Object(i.a)(a,2),l=r[0],c=r[1],s=Object(n.useState)(null),u=Object(i.a)(s,2),p=u[0],f=u[1],g=Object(n.useState)(""),v=Object(i.a)(g,2),y=v[0],j=v[1],E=Object(n.useState)(3e4),O=Object(i.a)(E,2),w=O[0],S=(O[1],Object(n.useState)(0)),N=Object(i.a)(S,2),R=N[0],z=N[1],k=Object(n.useState)(0),T=Object(i.a)(k,2),W=T[0],C=T[1],I=Object(n.useState)(""),L=Object(i.a)(I,2),D=L[0],H=L[1];Object(n.useEffect)((function(){var e="nb",t=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}("prov");console.log("url",t),t&&(e=t),console.log("Updating every ".concat(w/1e3," seconds")),d.a.get("/".concat(e,"/config")).then((function(e){200===e.status&&(console.log(e),j(e.data.title),z(e.data.seats),C(e.data.majority))})).catch((function(e){return console.log("error setting title")})),P(),B()}),[]),Object(n.useEffect)((function(){try{if(l&&p)if(p.overallResult.partyName&&p.overallResult.resultText){var e=p.overallResult.partyName+" "+p.overallResult.resultText;console.log(e),H(e)}else H("")}catch(t){}}),[l,p]);var P=function(){setInterval((function(){B()}),w)},B=function(){var e="nb";try{e=window.location.search.split("/").find((function(e){return e.includes("?prov=")})).split("=")[1]}catch(t){console.log("default province")}console.log("fetching"),d.a.get("/".concat(e,"/overallresults")).then((function(e){console.log(e.data),200===e.status&&c(e.data)})).catch((function(e){console.log("Error fetching results")})),d.a.get("/".concat(e,"/declaration")).then((function(e){console.log(e.data),200===e.status&&f(e.data)})).catch((function(e){console.log("Error fetching results")}))},J=[],M="";l&&(l.partyResults.map((function(t,a){J.push(o.a.createElement(m,{small:e.small,key:"".concat(t,"-").concat(a),name:t.nameShort,seats:t.seats,votes:t.votesPercent,color:t.color}))})),M=new Date(l.generated),-1===l.partyResults.findIndex((function(e){return"OTH"===e.nameShort}))&&(console.log("add other"),J.push(o.a.createElement(m,{key:-1,name:"OTH",seats:0,votes:0,color:"rgb(192, 192, 192)",small:e.small}))));return o.a.createElement("div",{className:t.main},o.a.createElement("div",{className:t.titleRow},o.a.createElement("div",{className:t.title},y)),D&&o.a.createElement(h,{declarationText:D}),l&&o.a.createElement("div",{className:t.barchart},o.a.createElement(b,{seatTotal:R,majority:W,majorityPercent:W/R*100,data:l})),o.a.createElement("div",{className:t.partyMap},J),l&&o.a.createElement("div",{className:t.update},"Last updated: ",M&&M.toString()))},O=window.innerWidth<500;l.a.render(o.a.createElement(E,{small:O?"true":void 0}),document.getElementById("root"))}},[[31,1,2]]]);
//# sourceMappingURL=main.7ddc0d7b.chunk.js.map